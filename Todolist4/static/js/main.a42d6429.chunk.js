(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(t,e,n){t.exports=n(36)},28:function(t,e,n){},30:function(t,e,n){},32:function(t,e,n){},34:function(t,e,n){},36:function(t,e,n){"use strict";n.r(e);var o=n(2),i=n(0),a=n.n(i),r=n(17),s=n.n(r);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(11),u=n(7),l=n(4),d=n(5),h=n(9),f=n(6),p=n(8),b="https://my4xnde1oti2ntm1odk3otm.herokuapp.com/v1",m=(n(28),function(t){function e(){var t,n;Object(l.a)(this,e);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(n=Object(h.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(i)))).loginRef=a.a.createRef(),n.passwordRef=a.a.createRef(),n.submitted=function(t){t.preventDefault();var e=n.loginRef.current.value,o=n.passwordRef.current.value;if(e&&o){var i=new Headers,a="Basic "+btoa(e+":"+o);i.set("Authorization",a),fetch(b+"/",{headers:i}).then(function(t){return t.json()}).then(function(t){t.user&&n.props.onAuthOk(a)})}},n}return Object(p.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return this.props.authorization?a.a.createElement("div",null,this.props.children):a.a.createElement("form",{className:"login-component",onSubmit:this.submitted},a.a.createElement("div",{className:"login-flex"},a.a.createElement("label",null,"Login"),a.a.createElement("input",{ref:this.loginRef,type:"text"}),a.a.createElement("label",null,"Password"),a.a.createElement("input",{ref:this.passwordRef,type:"password"}),a.a.createElement("input",{type:"submit",value:"Login"})))}}]),e}(i.Component)),E=Object(u.b)(function(t){return{authorization:t.authorization}},function(t){return{onAuthOk:function(e){return t({type:"AUTH_OK",authorization:e})}}})(m),O=n(1),v=(n(30),"todo,ongoing,finished,removed,canceled".split(/,/g));var g=function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(h.a)(this,Object(f.a)(e).call(this,t))).state={editing:!1},n.inputRef=a.a.createRef(),n._onEditionStart=n.onEditionStart.bind(Object(O.a)(Object(O.a)(n))),n._onEditionEnd=n.onEditionEnd.bind(Object(O.a)(Object(O.a)(n))),n}return Object(p.a)(e,t),Object(d.a)(e,[{key:"onEditionStart",value:function(t){this.state.editing||this.setState({editing:!0})}},{key:"onEditionEnd",value:function(t){if(this.state.editing){this.setState({editing:!1});var e=this.inputRef.current.innerText;this.props.onTitleChange&&this.props.onTitleChange(e)}}},{key:"componentDidUpdate",value:function(){this.state.editing&&this.inputRef.current.focus()}},{key:"render",value:function(){return a.a.createElement("div",{className:"task "+(this.props.status||"todo")},a.a.createElement("button",{onClick:this.props.onStatusChange}),a.a.createElement("span",{contentEditable:this.state.editing,onDoubleClick:this._onEditionStart,onBlur:this._onEditionEnd,ref:this.inputRef},this.props.title),a.a.createElement("time",null,this.props.creation))}}]),e}(i.Component),y=(n(32),function(t){function e(t){var n;return Object(l.a)(this,e),(n=Object(h.a)(this,Object(f.a)(e).call(this,t))).inputRef=a.a.createRef(),n._maybeNew=n.maybeNew.bind(Object(O.a)(Object(O.a)(n))),n._addTodo=n.addTodo.bind(Object(O.a)(Object(O.a)(n))),n}return Object(p.a)(e,t),Object(d.a)(e,[{key:"componentWillMount",value:function(){var t=this,e=new Headers;e.set("Authorization",this.props.authorization),fetch(b+"/buckets/default",{headers:e}).then(function(t){return t.json()}).catch(function(t){console.log("ERR",t)}).then(function(n){var o=n.data.id;fetch(b+"/buckets/"+o+"/collections",{headers:e}).then(function(t){return t.json()}).catch(function(t){console.log("ERR2",t)}).then(function(n){console.log("COLLECTIONS",o,n),t.getOrCreate(n.data,o,e)})})}},{key:"getOrCreate",value:function(t,e,n){var o=this;(n.set("Content-Type","application/json"),t.length&&t.filter(function(t){return"todolists"===t.id}).length)?(console.log("LISTING",e),this.listTodos(e)):fetch(b+"/buckets/"+e+"/collections",{method:"POST",headers:n,body:JSON.stringify({data:{id:"todolists"}})}).then(function(t){return t.json()}).then(function(t){console.log("CREATED",t),o.listTodos(e)})}},{key:"listTodos",value:function(t){var e=this,n=new Headers;n.set("Authorization",this.props.authorization),fetch(b+"/buckets/"+t+"/collections/todolists/records",{headers:n}).then(function(t){return t.json()}).catch(function(t){console.log("ERR3",t)}).then(function(n){console.log("GOT LISTS",n),e.createList(t,n)})}},{key:"createList",value:function(t,e){var n=this;if(e.data.length){var o=e.data[0],i=[b,"/buckets/",t,"/collections/todolists/records/",o.id].join("");this.props.onReceivedServerList(o.todos,i)}else{var a=[b,"/buckets/",t,"/collections/todolists/records"].join(""),r=new Headers;r.set("Authorization",this.props.authorization),r.set("Content-Type","application/json"),fetch(a,{method:"POST",headers:r,body:JSON.stringify({data:{todos:[]}})}).then(function(t){return t.json()}).then(function(t){console.log("CREATED LIST",t),n.props.onReceivedServerList([],a+"/"+t.data.id)})}}},{key:"maybeNew",value:function(t){13===t.keyCode&&this.addTodo()}},{key:"addTodo",value:function(){var t=this.inputRef.current.value;t&&(this.props.onNewTodo(t),this.inputRef.current.value="")}},{key:"render",value:function(){var t=this;return a.a.createElement("main",null,a.a.createElement("h1",null,"Todo list"),a.a.createElement("ul",{className:"todolist"},this.props.todos.map(function(e){var n,o=t.props.onStatusChange.bind(t,e.id,(n=e.status,v[(1+v.indexOf(n||""))%v.length])),i=t.props.onTitleChange.bind(t,e.id);return a.a.createElement("li",{key:e.id},a.a.createElement(g,{id:e.id,title:e.title,status:e.status,creation:e.creation,onStatusChange:o,onTitleChange:i}))})),a.a.createElement("div",{className:"newtitle"},a.a.createElement("input",{type:"text",onKeyUp:this._maybeNew,ref:this.inputRef}),a.a.createElement("button",{onClick:this._addTodo},"Add")))}}]),e}(i.Component)),T=Object(u.b)(function(t){return{todos:t.todos,authorization:t.authorization}},function(t){return{onStatusChange:function(e,n){t({type:"STATUS_CHANGE",id:e,status:n})},onTitleChange:function(e,n){n.trim()?t({type:"TITLE_CHANGE",id:e,title:n}):t({type:"TODO_DELETE",id:e})},onNewTodo:function(e){t({type:"TODO_ADD",title:e})},onReceivedServerList:function(e,n){console.log("RSL",e),t({type:"REPLACE_ALL",todos:e,syncurl:n})}}})(y);n(34);var j=Object(c.b)(function(t,e){switch(e.type){case"STATUS_CHANGE":return Object(o.a)({},t,{todos:t.todos.map(function(t){return t.id!==e.id?t:Object(o.a)({},t,{status:e.status})})});case"TITLE_CHANGE":return Object(o.a)({},t,{todos:t.todos.map(function(t){return t.id!==e.id?t:Object(o.a)({},t,{title:e.title})})});case"TODO_ADD":var n=t.todos.reduce(function(t,e){return Math.max(t,e.id)},0);return Object(o.a)({},t,{todos:t.todos.concat([{id:n+1,status:"todo",title:e.title,creation:(new Date).toISOString().replace(/T.*/,"")}])});case"TODO_DELETE":return Object(o.a)({},t,{todos:t.todos.filter(function(t){return t.id!==e.id})});case"AUTH_OK":return Object(o.a)({},t,{authorization:e.authorization});case"REPLACE_ALL":return console.log("GOTCHA",e),Object(o.a)({},t,{todos:e.todos,syncurl:e.syncurl});default:return t}},{todos:[]});j.subscribe(function(){return console.log("STORE",JSON.stringify(j.getState()))}),j.subscribe(function(){var t=j.getState();if(t.syncurl){var e=JSON.stringify({data:{todos:t.todos}}),n=new Headers;n.set("Authorization",t.authorization),n.set("Content-Type","application/json"),fetch(t.syncurl,{headers:n,method:"PUT",body:e}).then(function(t){return t.json()}).then(function(t){console.log("SAVED",t)})}}),s.a.render(a.a.createElement(u.a,{store:j},a.a.createElement(E,null,a.a.createElement(T,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.a42d6429.chunk.js.map